 echo $PATH
/home/sreoshika001/.venv/bin:/home/sreoshika001/.local/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
(.venv) sreoshika001@penguin:~/.venv$ 

source .venv/bin/activate


from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    browser = p.chromium.launch(headless=False)
    context = browser.new_context()
    page = context.new_page()

    page.goto("https://target-site.com")

    page.fill("#firstName", row["first_name"])
    page.fill("#lastName", row["last_name"])
    page.click("#next")

    page.screenshot(path="step1.png")



page.click("#next")
page.wait_for_selector("#addressForm")

def fill_page_1(page, data):
    ...

def fill_page_2(page, data):
    ...



page.screenshot(path=f"screenshots/{app_id}_page3.png", full_page=True)
app_id = page.inner_text("#applicationId")


try:
    fill_page_1(page, row)
except Exception as e:
    page.screenshot(path="error.png")
    log_error(row, str(e))


from playwright.sync_api import sync_playwright
import json

with sync_playwright() as p:
    browser = p.chromium.launch(headless=True)
    page = browser.new_page()

    # Go to the SPA page
    page.goto("https://your-dexray-app.com/app/123")

    # Wait until network is idle (all JS loaded)
    page.wait_for_load_state("networkidle")

    # Extract all text
    texts = [t.strip() for t in page.locator("body *").all_text_contents() if t.strip()]

    # Optional: convert to label-value JSON if consistent
    data = {texts[i]: texts[i+1] for i in range(0, len(texts)-1, 2)}

    # Save
    with open("dexray_data.json", "w") as f:
        json.dump(data, f, indent=2)


chrome://version
Profile Path

C:\Users\Arnab\AppData\Local\Google\Chrome\User Data\Default

from playwright.sync_api import sync_playwright

with sync_playwright() as p:
    context = p.chromium.launch_persistent_context(
        user_data_dir="C:/Users/Arnab/AppData/Local/Google/Chrome/User Data/Default",
        headless=False
    )

    page = context.new_page()
    page.goto("https://your-form-app")

cookies = context.cookies()
print([c for c in cookies if "flt" in c["name"].lower()])


'------

Step 1 ‚Äî Find the ATON / FLT API

In Chrome DevTools ‚Üí Network ‚Üí Fetch/XHR
Turn ATON ON and paste FLT.

You will see something like:```

POST /api/feature/aton
or
POST /api/security-context
or
POST /entitlements


{
  "aton": true,
  "flt": {
     "dexray": true,
     "ampometer": true
  }
}


def enable_aton_and_flt(page):
    payload = {
        "aton": True,
        "flt": {
            "dexray": True,
            "ampometer": True
        }
    }

    response = page.request.post(
        "https://your-form-app/api/feature/aton",
        data=payload
    )

    assert response.ok, "Failed to enable ATON"





verify flt
cookies = page.context.cookies()
print([c for c in cookies if "flt" in c["name"].lower()])

app_id = submit_form_and_capture_app_id(page)
dexray = fetch_dexray(page, app_id)



context.add_cookies([
    {
        "name": "anton",
        "value": "true",
        "domain": ".apply-qa.company.com",
        "path": "/"
    },
    {
        "name": "flt",
        "value": '{"featureLevelTest":true}',
        "domain": ".apply-qa.company.com",
        "path": "/"
    }
])

context = browser.new_context()

context.add_cookies([
    {
        "name": "anton",
        "value": "true",
        "domain": ".yourdomain.com",
        "path": "/"
    },
    {
        "name": "flt",
        "value": '{"featureLevelTest":true}',
        "domain": ".yourdomain.com",
        "path": "/"
    }
])

page = context.new_page()
page.goto("https://your-form/apply")


page.goto("https://your-form/apply?antonbypass=true&flt={json}")


page.route("https://mboxedge*.tt.omtrdc.net/**", lambda route: route.continue_(
    url=route.request.url + "&profile.featureLevelTest=true"
))



flt = {
    "featureLevelTest": True,
    "variant": "A",
    "model": "v2",
    "scoreThreshold": 720,
    "showIncome": True
}

def handler(route):
    url = route.request.url
    for k, v in flt.items():
        url += f"&profile.{k}={str(v).lower()}"
    route.continue_(url=url)

page.route("**/mboxedge*.tt.omtrdc.net/**", handler)




flt = {
    "featureLevelTest": {
        "offer": {
            "meta.feature.enabled": True,
            "meta.offersetid.qa": "arnabfrabrva"
        }
    }
}

# flatten nested dict into dot-separated keys
def flatten_dict(d, parent_key=""):
    items = {}
    for k, v in d.items():
        new_key = f"{parent_key}.{k}" if parent_key else k
        if isinstance(v, dict):
            items.update(flatten_dict(v, new_key))
        else:
            items[new_key] = v
    return items

flat_flt = flatten_dict(flt)

def handler(route):
    url = route.request.url
    for k, v in flat_flt.items():
        url += f"&profile.{k}={str(v).lower()}"
    route.continue_(url=url)

page.route("**/mboxedge*.tt.omtrdc.net/**", handler)
page.goto("https://apply-qa.company.com/apply")



if not os.path.exists("scenario_results.csv"):
    df = input_df.copy()
    df["scenario_result"] = "failed"
    df["last_error"] = ""
    df["run_ts"] = ""
    df.to_csv("scenario_results.csv", index=False)

df = pd.read_csv("scenario_results.csv")
to_run = df[df["scenario_result"] == "failed"]


for idx, row in to_run.iterrows():
    try:
        run_test(row)

        df.loc[idx, "scenario_result"] = "success"
        df.loc[idx, "last_error"] = ""
        df.loc[idx, "run_ts"] = datetime.now().isoformat()

    except Exception as e:
        df.loc[idx, "scenario_result"] = "failed"
        df.loc[idx, "last_error"] = str(e)
        df.loc[idx, "run_ts"] = datetime.now().isoformat()

    # üîê write full snapshot after each scenario
    df.to_csv("scenario_results.csv", index=False)


